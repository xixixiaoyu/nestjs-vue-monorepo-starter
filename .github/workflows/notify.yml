name: Notifications

on:
  workflow_run:
    workflows: ['CI', 'Security Scan', 'Deploy', 'Release', 'Performance Test']
    types:
      - completed
  status: []
  check_run:
    types: [completed]

jobs:
  # CI é€šçŸ¥
  ci-notification:
    name: CI Notification
    runs-on: ubuntu-latest
    if: github.event.workflow_run.name == 'CI'
    steps:
      - name: Get workflow conclusion
        id: conclusion
        run: |
          echo "conclusion=${{ github.event.workflow_run.conclusion }}" >> $GITHUB_OUTPUT

      - name: Notify Slack on Success
        if: steps.conclusion.outputs.conclusion == 'success'
        run: |
          echo "âœ… CI pipeline completed successfully!"
          # curl -X POST -H 'Content-type: application/json' \
          #   --data '{"text":"âœ… CI pipeline for ${{ github.repository }} completed successfully!\n\nBranch: ${{ github.event.workflow_run.head_branch }}\nCommit: ${{ github.event.workflow_run.head_sha }}\n\nğŸ”— [View Workflow](${{ github.event.workflow_run.html_url }})"}' \
          #   ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Notify Slack on Failure
        if: steps.conclusion.outputs.conclusion == 'failure'
        run: |
          echo "âŒ CI pipeline failed!"
          # curl -X POST -H 'Content-type: application/json' \
          #   --data '{"text":"âŒ CI pipeline for ${{ github.repository }} failed!\n\nBranch: ${{ github.event.workflow_run.head_branch }}\nCommit: ${{ github.event.workflow_run.head_sha }}\n\nğŸ”— [View Workflow](${{ github.event.workflow_run.html_url }})"}' \
          #   ${{ secrets.SLACK_WEBHOOK_URL }}

  # å®‰å…¨æ‰«æé€šçŸ¥
  security-notification:
    name: Security Notification
    runs-on: ubuntu-latest
    if: github.event.workflow_run.name == 'Security Scan'
    steps:
      - name: Get workflow conclusion
        id: conclusion
        run: |
          echo "conclusion=${{ github.event.workflow_run.conclusion }}" >> $GITHUB_OUTPUT

      - name: Notify Slack on Security Issues
        if: steps.conclusion.outputs.conclusion == 'failure'
        run: |
          echo "ğŸš¨ Security scan found issues!"
          # curl -X POST -H 'Content-type: application/json' \
          #   --data '{"text":"ğŸš¨ Security scan for ${{ github.repository }} found issues!\n\nBranch: ${{ github.event.workflow_run.head_branch }}\nCommit: ${{ github.event.workflow_run.head_sha }}\n\nğŸ”— [View Security Scan](${{ github.event.workflow_run.html_url }})"}' \
          #   ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Send Email on Security Issues
        if: steps.conclusion.outputs.conclusion == 'failure'
        run: |
          echo "Sending security notification email..."
          # è¿™é‡Œå¯ä»¥æ·»åŠ é‚®ä»¶å‘é€é€»è¾‘
          # ä½¿ç”¨ GitHub Actions çš„é‚®ä»¶å‘é€ action æˆ–è‡ªå®šä¹‰è„šæœ¬

  # éƒ¨ç½²é€šçŸ¥
  deployment-notification:
    name: Deployment Notification
    runs-on: ubuntu-latest
    if: github.event.workflow_run.name == 'Deploy'
    steps:
      - name: Get workflow conclusion
        id: conclusion
        run: |
          echo "conclusion=${{ github.event.workflow_run.conclusion }}" >> $GITHUB_OUTPUT

      - name: Notify Slack on Deployment Success
        if: steps.conclusion.outputs.conclusion == 'success'
        run: |
          echo "ğŸš€ Deployment completed successfully!"
          # curl -X POST -H 'Content-type: application/json' \
          #   --data '{"text":"ğŸš€ Deployment for ${{ github.repository }} completed successfully!\n\nBranch: ${{ github.event.workflow_run.head_branch }}\nCommit: ${{ github.event.workflow_run.head_sha }}\n\nğŸ”— [View Deployment](${{ github.event.workflow_run.html_url }})"}' \
          #   ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Notify Slack on Deployment Failure
        if: steps.conclusion.outputs.conclusion == 'failure'
        run: |
          echo "âŒ Deployment failed!"
          # curl -X POST -H 'Content-type: application/json' \
          #   --data '{"text":"âŒ Deployment for ${{ github.repository }} failed!\n\nBranch: ${{ github.event.workflow_run.head_branch }}\nCommit: ${{ github.event.workflow_run.head_sha }}\n\nğŸ”— [View Deployment](${{ github.event.workflow_run.html_url }})"}' \
          #   ${{ secrets.SLACK_WEBHOOK_URL }}

  # å‘å¸ƒé€šçŸ¥
  release-notification:
    name: Release Notification
    runs-on: ubuntu-latest
    if: github.event.workflow_run.name == 'Release'
    steps:
      - name: Get workflow conclusion
        id: conclusion
        run: |
          echo "conclusion=${{ github.event.workflow_run.conclusion }}" >> $GITHUB_OUTPUT

      - name: Notify Slack on Release
        if: steps.conclusion.outputs.conclusion == 'success'
        run: |
          echo "ğŸ‰ New release published!"
          # curl -X POST -H 'Content-type: application/json' \
          #   --data '{"text":"ğŸ‰ New release for ${{ github.repository }} is now available!\n\nBranch: ${{ github.event.workflow_run.head_branch }}\nCommit: ${{ github.event.workflow_run.head_sha }}\n\nğŸ”— [View Release](${{ github.event.workflow_run.html_url }})"}' \
          #   ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Send Release Email
        if: steps.conclusion.outputs.conclusion == 'success'
        run: |
          echo "Sending release announcement email..."
          # è¿™é‡Œå¯ä»¥æ·»åŠ é‚®ä»¶å‘é€é€»è¾‘

  # æ€§èƒ½æµ‹è¯•é€šçŸ¥
  performance-notification:
    name: Performance Notification
    runs-on: ubuntu-latest
    if: github.event.workflow_run.name == 'Performance Test'
    steps:
      - name: Get workflow conclusion
        id: conclusion
        run: |
          echo "conclusion=${{ github.event.workflow_run.conclusion }}" >> $GITHUB_OUTPUT

      - name: Notify Slack on Performance Issues
        if: steps.conclusion.outputs.conclusion == 'failure'
        run: |
          echo "âš ï¸ Performance test detected issues!"
          # curl -X POST -H 'Content-type: application/json' \
          #   --data '{"text":"âš ï¸ Performance test for ${{ github.repository }} detected issues!\n\nBranch: ${{ github.event.workflow_run.head_branch }}\nCommit: ${{ github.event.workflow_run.head_sha }}\n\nğŸ”— [View Performance Test](${{ github.event.workflow_run.html_url }})"}' \
          #   ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Send Performance Report
        if: steps.conclusion.outputs.conclusion == 'success'
        run: |
          echo "Sending performance report..."
          # è¿™é‡Œå¯ä»¥æ·»åŠ æ€§èƒ½æŠ¥å‘Šå‘é€é€»è¾‘

  # çŠ¶æ€å˜æ›´é€šçŸ¥
  status-notification:
    name: Status Notification
    runs-on: ubuntu-latest
    if: github.event_name == 'status'
    steps:
      - name: Notify on Status Change
        run: |
          echo "Status changed for commit ${{ github.event.sha }}"
          echo "State: ${{ github.event.state }}"
          echo "Context: ${{ github.event.context }}"
          echo "Description: ${{ github.event.description }}"

      - name: Notify Slack on Critical Status Changes
        if: github.event.state == 'failure' && (github.event.context == 'ci/circleci' || github.event.context == 'continuous-integration/jenkins')
        run: |
          echo "ğŸš¨ Critical status change detected!"
          # curl -X POST -H 'Content-type: application/json' \
          #   --data '{"text":"ğŸš¨ Critical status change for ${{ github.repository }}!\n\nCommit: ${{ github.event.sha }}\nContext: ${{ github.event.context }}\nState: ${{ github.event.state }}\nDescription: ${{ github.event.description }}"}' \
          #   ${{ secrets.SLACK_WEBHOOK_URL }}

  # æ£€æŸ¥è¿è¡Œé€šçŸ¥
  check-run-notification:
    name: Check Run Notification
    runs-on: ubuntu-latest
    if: github.event_name == 'check_run'
    steps:
      - name: Notify on Check Run Completion
        run: |
          echo "Check run completed: ${{ github.event.check_run.name }}"
          echo "Status: ${{ github.event.check_run.status }}"
          echo "Conclusion: ${{ github.event.check_run.conclusion }}"

      - name: Notify Slack on Failed Check Runs
        if: github.event.check_run.conclusion == 'failure'
        run: |
          echo "âŒ Check run failed!"
          # curl -X POST -H 'Content-type: application/json' \
          #   --data '{"text":"âŒ Check run failed for ${{ github.repository }}!\n\nCheck: ${{ github.event.check_run.name }}\nCommit: ${{ github.event.check_run.head_sha }}\n\nğŸ”— [View Details](${{ github.event.check_run.html_url }})"}' \
          #   ${{ secrets.SLACK_WEBHOOK_URL }}

  # æ¯æ—¥æ±‡æ€»é€šçŸ¥
  daily-summary:
    name: Daily Summary
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule'
    steps:
      - name: Generate Daily Summary
        run: |
          echo "Generating daily summary for $(date +%Y-%m-%d)"

          # è¿™é‡Œå¯ä»¥æ·»åŠ è·å–è¿‡å» 24 å°æ—¶å†…æ‰€æœ‰å·¥ä½œæµçŠ¶æ€çš„é€»è¾‘
          # ç„¶åç”Ÿæˆæ±‡æ€»æŠ¥å‘Š

      - name: Send Daily Summary to Slack
        run: |
          echo "Sending daily summary to Slack..."
          # curl -X POST -H 'Content-type: application/json' \
          #   --data '{"text":"ğŸ“Š Daily Summary for ${{ github.repository }} - $(date +%Y-%m-%d)\n\nHere is the summary of all activities in the past 24 hours..."}' \
          #   ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Send Daily Summary Email
        run: |
          echo "Sending daily summary email..."
          # è¿™é‡Œå¯ä»¥æ·»åŠ é‚®ä»¶å‘é€é€»è¾‘
